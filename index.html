<html>
    <head>
        <!-- <meta lang="en"> -->
        <meta charset="utf-8">
        <meta name="full-screen" content="yes">
        <meta name="viewport" content="user-scalable=no, width=device-width" />
        <meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
        <link rel="stylesheet" href="./navStyle.css">
        <title>CG Project</title>

        <script type='text/javascript' src="./src/webgl-obj-loader.js"></script>
        <script type='text/javascript' src="./src/webgl-lessons-ui.js"></script>
        <script type='text/javascript' src="./src/virtualjoystick.js"></script>
        <script type='module' src="./src/ui.js"></script>
        <script type="module" src="./src/main.js"></script>
        <script type="module" src="./src/navInteraction.js"></script>

        <style>
        body {
            background-color: "black";
            overflow: hidden;
        }
        #loading_box{
            width:400;
            height:300px;
            position:absolute;
            left:50%;
            top:50%;
            margin-top:-150px;
            margin-left:-200px;
            }
		#container {
			position: fixed;
            height: 100%;
            width: 100%;
            top: 0;
            overflow: hidden;
            /* overflow-x: hidden; */
            /* -webkit-overflow-scrolling: touch; */
		}
        #uiContainer {
        position: absolute;
        top: 50px;
        right: 10px;
        z-index: 3;
        font-family: monospace;
        pointer-events: none;

        text-shadow:
        -1px -1px 0 #FFF,
            1px -1px 0 #FFF,
            -1px 1px 0 #FFF,
            1px 1px 0 #FFF;
        }
        #ui {
        opacity: 0.8;
        }
        #ui>div {
        pointer-events: none;
        }
        #ui input, #ui select, #ui option, #ui canvas {
        pointer-events: auto;
        }
		</style>
    </head>
    <body style="background-color: rgb(28,39,58)">
        <!-- Navigation bar -->
        <header class="nav-container">
            <h1 class="nav-header">                
                <text class="nav-item is-header-item">Ruins and Paper Plane</text>
            </h1>
            <nav class="nav-menu-wrapper">
                <span class="nav-item is-menu-item menu-icon" onclick="return false;"></span>

                <ul class="nav-menu-list">
                    <li><button id="pauseButton" class="nav-item">Pause</button></li>
                    <li><button id="navButton" class="nav-item" style="visibility: visible;" >Enable Navigation</button></li>
                    <li><button id="lightButton" class="nav-item" style="visibility: visible;" >Edit Light</button></li>
                    <li><button id="fogButton" class="nav-item" style="visibility: visible;" >Edit Fog</button></li>
                    <li><button id="perspectiveButton" class="nav-item" style="visibility: visible;" >Edit Perspective</button></li>
                    <li><button id="OBJButton" class="nav-item" style="visibility: visible;">Export OBJ</button></li>
                    <li><button id="joystickShowButton" class="nav-item" style="visibility: visible;" >Hide Joystick</button></li>
                </ul>

                <ul class="nav-menu-list">
                    <!-- <li><a href="https://webgl-shaders.com/about.html" class="nav-item">About</a></li>
                    <li><a href="https://github.com/jagracar/webgl-shader-examples" class="nav-item"><span class="github-icon"></span>
                            Github</a></li> -->
                </ul>
            </nav>
        </header>

        <script>
            window.touchSupport = false;
            window.loadingResource = true;
            window.navMode = false;
            window.pauseCond = false;
            const buttons={
                pause: document.getElementById("pauseButton"),
                nav  : document.getElementById("navButton"),
                light  : document.getElementById("lightButton"),
                fog  : document.getElementById("fogButton"),
                perspective  : document.getElementById("perspectiveButton"),
                joystickDisable  : document.getElementById("joystickShowButton"),
            }
            // insert a state variable and an onclick function into each of the button.
            for (let each in buttons){
                buttons[each].state=false;
                buttons[each].onclick = function () {
                    this.state = !this.state;
                    this.update();
                }
            }
            console.log(buttons);
            buttons.pause.update=function(){this.innerHTML=!this.state?"Pause":"Continue"; window.pauseCond = this.state;};
            buttons.nav.update  =function(){this.innerHTML=!this.state?"Enable Navigation":"Disable Navigation";window.navMode = this.state;};
            buttons.light.update=function(){this.innerHTML=!this.state?"Edit Light":"Close"; document.getElementById('Light').style.visibility = this.state ? "visible" : "hidden";
                    if (this.state) resetStates(this);};
            buttons.fog.update  =function(){this.innerHTML=!this.state?"Edit Fog":"Close"; document.getElementById('Fog').style.visibility = this.state?"visible":"hidden";
                if (this.state) resetStates(this);};
            buttons.perspective.update=function(){this.innerHTML=!this.state?"Edit Perspective":"Close"; document.getElementById('PerspectiveZ').style.visibility=this.state?"visible":"hidden";
            document.getElementById('PerspectiveY').style.visibility = this.state ? "visible" : "hidden";
                if (this.state) resetStates(this);};
            buttons.joystickDisable.update=function(){this.innerHTML=!this.state?"Hide Joystick":"Show Joystick"; document.getElementById('joy_container').style.visibility = this.state ? "hidden" : "visible";
                    if (this.state) resetStates(this);};

            const sliders=["light","fog","perspective"];
            // resets all the conditions in states to flag. There's only one place to display the slider.
            var resetStates = function(skip){
                for (let button of sliders){
                    if (buttons[button]==skip) continue;
                    buttons[button].state=false;
                    buttons[button].update();
                }
            };
        </script>

        <!-- <div  style="font-size: 40px; color: green; visibility: none;">  -->
            <img id="loading_box" src="./resource/loading.gif">
        <!-- </div> -->
        <div id="joy_container" style="position: absolute; left: 10%; top: 60%; width: 200px; height: 200px;z-index: 1; visibility: none;">
        
        </div>
        <div id="container">
            <canvas id="c" style=" width: 100%; height: 100%; visibility: hidden;"></canvas>
            
            <script>
                    var BX = document.body.clientWidth * 0.1;
                    var BY = document.body.clientHeight * 0.6;
                    console.log(BX, BY);

                    var joystick = new VirtualJoystick({
                        container:  document.getElementById('joy_container'),
                        mouseSupport: true,
                        stationaryBase: true,
                                baseX: 100,
                                baseY: 100,
                        limitStickTravel: true,
                        stickRadius: 50,
                        biasX: BX,
                        biasY: BY
                    });

                    console.log(VirtualJoystick.touchScreenAvailable());
                    if(!VirtualJoystick.touchScreenAvailable())
                    {
                        window.touchSupport = false;
                        // joystickShowCond = false;
                        // document.getElementById('joystickShowButton').innerHTML = "Show Joystick";
                        // document.getElementById('joy_container').style.visibility = "hidden";
                    }else{
                        window.touchSupport = true;
                        // joystickShowCond = true;
                        // document.getElementById('joystickShowButton').innerHTML = "Hide Joystick";
                        // document.getElementById('joy_container').style.visibility = "visible";
                    }
                    
            </script>

            <div id="uiContainer">
                <div id="ui">
                    <div id="Light" style="position: absolute; top: 20px; right: 20px; visibility: hidden;"></div>
                    <div id="Fog" style="position: absolute; top: 20px; right: 20px; visibility: hidden;"></div>
                    <div id="PerspectiveZ" style="position: absolute; top: 20px; right: 20px; visibility: hidden;"></div>
                    <div id="PerspectiveY" style="position: absolute; top: 80px; right: 20px; visibility: hidden;"></div>
                </div>
            </div>


            <!-- <div style="position: absolute; right: 3%; bottom: 10%;">
                <div style="color: pink; text-align: center; width: 300px; margin: 0 auto;">
                    <p style="font-size: 10px; border: 5px solid">
                        Camera Navigation Demo
                    </p>
                    <p>
                        WSADEQ -- Front Back Left Right Up Down
                    </p>
                    <p>
                        IKJL/Slide Screen -- Change Sight View
                    </p>
                </div>
                
                <div style="text-align: center; font-size: 20px;">
                    <ul>
                        <li><a href="./pages/Flight/Flight.html">Flight</a></li>
                        <li><a href="./pages/Preview/Preview.html">Shader Preview</a></li>
                        <li><a href="http://code.vtu.life"> Back</a></li>
                    </ul>
                </div>
            </div> -->
        </div>
    </body>
</html>
